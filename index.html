<!DOCTYPE html>
<html lang="en">
<head>
  <title>FUN NIGHT</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <link rel="stylesheet" type="text/css" href="css/index.css" media="screen">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.css"></script>

  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <link rel="stylesheet" href="css/result.css">
</head>

<body class="bg-dark">
  <div id="form-container" class="container bg-secondary my-5 p-5">
    <div class="row">
      <div class="col-12 my-auto">
        <form id="regForm" class="mx-auto">

          <h1>Register:</h1>
          <!-- One "tab" for each step in the form: -->
          <div class="tab">
            <div class="form-group">
                <label for="loc">Location</label>
                <input type="text" class="form-control" id="loc">
            </div>
            <script src="https://maps.googleapis.com/maps/api/js?libraries=geometry"></script>
            <div id="info"></div>
            <div id="map-canvas"></div>
          </div>
          
          <div class="tab">
            <h3>Categories</h3>
            <table>
              <thead>
                <tr>
                  <th>Category</th>
                  <th>Include</th>
                  <th>I want to spend</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <input id="food-form" value="0" style="display: none;">
                  <td>Food</td>
                  <td>
                    <input type="checkbox" id="food-form-include">
                  </td>
                  <td>
                    <span class="stars-outer" onclick="changeStars(1, 'food-form');">
                      <span id="food-form-1" class="stars-inner"></span>
                    </span>
                    <span class="stars-outer" onclick="changeStars(2, 'food-form');">
                      <span id="food-form-2" class="stars-inner"></span>
                    </span>
                    <span class="stars-outer" onclick="changeStars(3, 'food-form');">
                      <span id="food-form-3" class="stars-inner"></span>
                    </span>
                    <span class="stars-outer" onclick="changeStars(4, 'food-form');">
                      <span id="food-form-4" class="stars-inner"></span>
                    </span>
                  </td>
                </tr>
                <tr>
                  <input id="entertainment-form" value="0" style="display: none;">
                  <td>Entertainment</td>
                  <td>
                    <input type="checkbox" id="entertainment-form-include">
                  </td>
                  <td>
                    <span class="stars-outer" onclick="changeStars(1, 'entertainment-form');">
                      <span id="entertainment-form-1" class="stars-inner"></span>
                    </span>
                    <span class="stars-outer" onclick="changeStars(2, 'entertainment-form');">
                      <span id="entertainment-form-2" class="stars-inner"></span>
                    </span>
                    <span class="stars-outer" onclick="changeStars(3, 'entertainment-form');">
                      <span id="entertainment-form-3" class="stars-inner"></span>
                    </span>
                    <span class="stars-outer" onclick="changeStars(4, 'entertainment-form');">
                      <span id="entertainment-form-4" class="stars-inner"></span>
                    </span>
                  </td>
                </tr>
                <tr>
                  <input id="shopping-form" value="0" style="display: none;">
                  <td>Shopping</td>
                  <td>
                    <input type="checkbox" id="shopping-form-include">
                  </td>
                  <td>
                    <span class="stars-outer" onclick="changeStars(1, 'shopping-form');">
                      <span id="shopping-form-1" class="stars-inner"></span>
                    </span>
                    <span class="stars-outer" onclick="changeStars(2, 'shopping-form');">
                      <span id="shopping-form-2" class="stars-inner"></span>
                    </span>
                    <span class="stars-outer" onclick="changeStars(3, 'shopping-form');">
                      <span id="shopping-form-3" class="stars-inner"></span>
                    </span>
                    <span class="stars-outer" onclick="changeStars(4, 'shopping-form');">
                      <span id="shopping-form-4" class="stars-inner"></span>
                    </span>
                  </td>
                </tr>
                <tr>
                  <input id="self-care-form" value="0" style="display: none;">
                  <td>Self care</td>
                  <td>
                    <input type="checkbox" id="self-care-form-include">
                  </td>
                  <td>
                    <span class="stars-outer" onclick="changeStars(1, 'self-care-form');">
                      <span id="self-care-form-1" class="stars-inner"></span>
                    </span>
                    <span class="stars-outer" onclick="changeStars(2, 'self-care-form');">
                      <span id="self-care-form-2" class="stars-inner"></span>
                    </span>
                    <span class="stars-outer" onclick="changeStars(3, 'self-care-form');">
                      <span id="self-care-form-3" class="stars-inner"></span>
                    </span>
                    <span class="stars-outer" onclick="changeStars(4, 'self-care-form');">
                      <span id="self-care-form-4" class="stars-inner"></span>
                    </span>
                  </td>
                </tr>
                <tr>
                  <input id="drinks-form" value="0" style="display: none;">
                  <td>Drinks</td>
                  <td>
                    <input type="checkbox" id="drinks-form-include">
                  </td>
                  <td>
                    <span class="stars-outer" onclick="changeStars(1, 'drinks-form');">
                      <span id="drinks-form-1" class="stars-inner"></span>
                    </span>
                    <span class="stars-outer" onclick="changeStars(2, 'drinks-form');">
                      <span id="drinks-form-2" class="stars-inner"></span>
                    </span>
                    <span class="stars-outer" onclick="changeStars(3, 'drinks-form');">
                      <span id="drinks-form-3" class="stars-inner"></span>
                    </span>
                    <span class="stars-outer" onclick="changeStars(4, 'drinks-form');">
                      <span id="drinks-form-4" class="stars-inner"></span>
                    </span>
                  </td>
                <tr>
                  <input id="random-form" value="0" style="display: none;">
                  <td>Random</td>
                  <td>
                    <input type="checkbox" id="random-form-include">
                  </td>
                  <td>
                    <span class="stars-outer" onclick="changeStars(1, 'random-form');">
                      <span id="random-form-1" class="stars-inner"></span>
                    </span>
                    <span class="stars-outer" onclick="changeStars(2, 'random-form');">
                      <span id="random-form-2" class="stars-inner"></span>
                    </span>
                    <span class="stars-outer" onclick="changeStars(3, 'random-form');">
                      <span id="random-form-3" class="stars-inner"></span>
                    </span>
                    <span class="stars-outer" onclick="changeStars(4, 'random-form');">
                      <span id="random-form-4" class="stars-inner"></span>
                    </span>
                  </td>
                </tr>
            
              </tbody>
            </table> 
          </div>

          
          <div style="overflow:auto;">
            <div style="float:right;">
              <button type="button" id="prevBtn" onclick="nextPrev(-1)">Previous</button>
              <button type="button" id="nextBtn" onclick="nextPrev(1)">Next</button>
            </div>
          </div>
          
          <div onclick="handleSubmit()" class="btn btn-block bg-success">Submit</div> 

          <!-- Circles which indicates the steps of the form: -->
          <div style="text-align:center;margin-top:40px;">
            <span class="step"></span>
            <span class="step"></span>
          </div>

          </form>
        </div>
      </div>
    </div>



  <script src="js/script.js"></script>
  <script src="js/jaren.js"></script>
  <script src="js/searchForm.js"></script>
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>








  <div class="d-flex justify-content-around align-items-baseline bg-light">
      <div>
          <h1>Schedule</h1>
      </div>
      <div class="">
          <a class="btn btn-primary" href="/index.html" role="button">Back</a>
      </div>
  </div>
  <div class="text-center">
      <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d381047.92790397763!2d-112.11456220022761!3d41.74345309876192!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x87547de837c9b55f%3A0x683330b88a6cb3a4!2sLogan%20Lanes!5e0!3m2!1sen!2sus!4v1573884556921!5m2!1sen!2sus" width="600" height="450" frameborder="0" style="border:0;" allowfullscreen=""></iframe>
  </div>
  <div class="py-5 bg-light">
      <div class="container">
          <div class="row" id="target">

          </div>
      </div>
  </div>
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/2.3.0/mustache.min.js"></script>
  <script>






  
      function handleSubmit() {
          var requestString = "";

          // var location = document.getElementById("input-location").value;
          // var radius = document.getElementById("radius").value;

          var location = document.getElementById("loc").value;
          var radius = "10000";

          var googleData;



          location = location.replace(" ", "+");


          var geocodeURL = "https://maps.googleapis.com/maps/api/geocode/json?address=" + location + "&key=" + getLine();

          // Erik's fetch method
          console.log("Fetching geocode: " + geocodeURL);
          var lat;
          var long;

          const proxyurl = "https://cors-anywhere.herokuapp.com/";

          fetch(geocodeURL)
              .then(r => r.json()) 

              .then(json => { 
                  theData = json;

                  console.log(theData);

                  lat = theData.results[0].geometry.location.lat;
                  long = theData.results[0].geometry.location.lng;
                  console.log("Longitude and latitude: " + lat + " " + long);


                  var googleURL = "https://maps.googleapis.com/maps/api/place/nearbysearch/json?location=" + lat + "," + long + "&radius=" + radius + "&min=0" + "&key=" + getLine();
              
                  console.log("FETCHING: " + googleURL);
              
              
                  // Erik's fetch method
                  fetch(proxyurl + googleURL)
                      .then(r => r.json()) 
              
                      .then(json => { 
                          googleData = json;
                          console.log(googleData);


                          var orgResults = {
                              food: [],
                              entertainment: [],
                              shopping: [],
                              selfcare: [],
                              drinks: [],
                              random: [],
                          }


                          var results = googleData.results;

                          for (var i = 0; i < results.length; i++) {
                              for (var j = 0; j < results[i].types.length; j++) {
                                  if (results[i].types[j] == "food") {
                                      console.log(results[i].name);
                                      orgResults.food.push(results[i]);
                                  }
                                  if (results[i].types[j] == "aquarium" || results[i].types[j] == "art_gallery" || results[i].types[j] == "bowling_alley" || results[i].types[j] == "campground" ||  results[i].types[j] == "casino" ||  results[i].types[j] == "library" || results[i].types[j] == "movie_theater" || results[i].types[j] == "museum" || results[i].types[j] == "night_club" || results[i].types[j] == "park" || results[i].types[j] == "tourist_attraction" || results[i].types[j] == "zoo"){
                                      console.log(results[i].name);
                                      orgResults.entertainment.push(results[i]);
                                  }
                                  // if (results[i].types[j] == "bicycle_store" || name[i].types[j] == "book_store" || name[i].types[j] == "clothing_store" || name[i].types[j] == "convenience_store" || name[i].types[j] == "department_store" || name[i].types[j] == "drugstore" || name[i].types[j] == "electronics_store" || name[i].types[j] == "florist" || name[i].types[j] == "furniture_store" || name[i].types[j] == "gas_station" || name[i].types[j] == "grocery_or_supermarket" || name[i].types[j] == "hardware_store" || name[i].types[j] == "home_goods_store" || name[i].types[j] == "jewelry_store" || name[i].types[j] == "shoe_store" || name[i].types[j] == "shopping_mall" || name[i].types[j] == "store" || ) {
                                  if (results[i].types[j] == "store") {
                                      console.log(results[i].name);
                                      orgResults.shopping.push(results[i]);
                                  }
                                  if (results[i].types[j] == "beauty_salon" || results[i].types[j] == "hair_care" || results[i].types[j] == "gym" || results[i].types[j] == "spa") {
                                      console.log(results[i].name);
                                      orgResults.selfcare.push(results[i]);
                                  }
                                  if (results[i].types[j] == "bar" || results[i].types[j] == "liquor_store" || results[i].types[j] == "grocery_or_supermarket" || results[i].types[j] == "supermarket") {
                                      console.log(results[i].name);
                                      orgResults.drinks.push(results[i]);
                                  }
                              }
                              console.log(results[i].name);
                              orgResults.random.push(results[i]);
                          }

                          var resultingPlaces = [];

                          var foodCheckbox = document.getElementById("food-form-include").checked;
                          if (foodCheckbox) {
                              pickedFood = getRandomElement(orgResults.food);
                              resultingPlaces.push(pickedFood);
                              // for (var i = 0; i < orgResults.food.length; i++) {
                              //     if (orgResults.food[i].rating > foodCheckbox) {
                                      
                              //     }
                              // }
                          }

                          var entertainmentCheckbox = document.getElementById("entertainment-form-include").checked;
                          if (entertainmentCheckbox) {
                              pickedEntertainment = getRandomElement(orgResults.entertainment);
                              resultingPlaces.push(pickedEntertainment);

                              // for (var i = 0; i < orgResults.entertainment.length; i++) {
                              //     if (orgResults.entertainment[i].rating > entertainmentCheckbox) {
                              //         orgByValue.push(orgResults.entertainment[i]);
                              //     }
                              // }
                          }

                          var shoppingCheckbox = document.getElementById("shopping-form-include").checked;
                          if (shoppingCheckbox) {
                              pickedShopping = getRandomElement(orgResults.shopping);
                              resultingPlaces.push(pickedShopping);

                              // for (var i = 0; i < orgResults.shopping.length; i++) {
                              //     if (orgResults.shopping[i].rating > shoppingCheckbox) {
                              //         orgByValue.push(orgResults.shopping[i]);
                              //     }
                              // }
                          }

                          var selfcareCheckbox = document.getElementById("self-care-form-include").checked;
                          if (selfcareCheckbox) {
                              pickedSelfcare = getRandomElement(orgResults.selfcare);
                              resultingPlaces.push(pickedSelfcare);

                              // for (var i = 0; i < orgResults.selfcare.length; i++) {
                              //     if (orgResults.selfcare[i].rating > selfcareCheckbox) {
                              //         orgByValue.push(orgResults.selfcare[i]);
                              //     }
                              // }
                          }

                          var drinksCheckbox = document.getElementById("drinks-form-include").checked;
                          if (drinksCheckbox) {
                              pickedDrinks = getRandomElement(orgResults.drinks);
                              resultingPlaces.push(pickedDrinks);

                              // for (var i = 0; i < orgResults.drinks.length; i++) {
                              //     if (orgResults.drinks[i].rating > drinkCheckbox) {
                              //         orgByValue.push(orgResults.drinks[i]);
                              //     }
                              // }
                          }

                          var randomCheckbox = document.getElementById("random-form-include").checked;
                          if (randomCheckbox) {
                              pickedRandom = getRandomElement(orgResults.random);
                              resultingPlaces.push(pickedRandom);

                              // for (var i = 0; i < orgResults.drinks.length; i++) {
                              //     if (orgResults.drinks[i].rating > drinkCheckbox) {
                              //         orgByValue.push(orgResults.drinks[i]);
                              //     }
                              // }
                          }

                          var data = {
                              items: []
                          };

                          // console.log(resultingPlaces);

                          
                          console.log("Resulting places" + resultingPlaces);

                          for (var i = 0; i < resultingPlaces.length; i++) {
                            console.log("dafadfd" + resultingPlaces[0]);
                            if (typeof(resultingPlaces[i]) != "undefined") {
                              var newPlace = {
                                  name: "" + resultingPlaces[i].name,
                                  vicinity: "" + resultingPlaces[i].vicinity,
                                  // img: "" + resultingPlaces.keys(i).photos[0],
                              }

                              data.items.push(newPlace);
                            }

                          }          

                          // console.dir(data);

                          
                          var template = `{{#items}}
                          <div class="col-md-12 place">
                                      <div class="card mb-4 shadow-sm">
                                          <img src="img/Screen Shot 2019-11-15 at 10.25.30 PM.png" alt="">
                                          <div class="card-body">
                                              <h3>{{name}}</h3>
                                              <h4>{{vicinity}}</h4>
                                              <span class="badge badge-pill badge-primary">{{category}}</span>
                                              <div><br></div>
                                              <div class="d-flex justify-content-between align-items-center">
                                                  <div class="btn-group">
                                                      <button type="button" class="btn btn-sm btn-outline-secondary"><a href="https://loganlanesinc.com/">Detail</a></button>
                                                  </div>
                                              </div>
                                          </div>
                                      </div>
                                  </div>
                              </div>
                              <div class="col-md-12">
                                  <div class="arrow mx-auto"></div>
                              </div>
                              {{/items}}`;

                          // Mustache.js実行
                          var html = Mustache.render(template, data);

                          // DOM操作
                          $('#target').html(html);
              
                          // var data = {
                          //     items: [
                          //         {name: , price: 200, time: "9:00am - 10:00pm", category: "Entertaiment", img: ""},
                          //         {name: "Logan Lanes", price: 200, time: "9:00am - 10:00pm", category: "Entertaiment", img: ""},
                          //         {name: "Logan Lanes", price: 200, time: "9:00am - 10:00pm", category: "Entertaiment", img: ""},
                          //         {name: "Logan Lanes", price: 200, time: "9:00am - 10:00pm", category: "Entertaiment", img: ""},
                          //         {name: "Logan Lanes", price: 200, time: "9:00am - 10:00pm", category: "Entertaiment", img: ""},
                          //     ]
                          // };
              
              
                  });

          });
      }

      function getLine() {
          var config = {
              first: "AIzaSXyCW",
              second: "afdsAvOrG",
              third: "NrtBX7RP",
              fourth: "OmXjcfwtX5",
              fifth: "aNkJXXEvw"
          }
          var size = Object.keys(config).length;
          var textByLine = "";

          textByLine += config["first"];
          textByLine += config["second"];
          textByLine += config["third"];
          textByLine += config["fourth"];
          textByLine += config["fifth"];
          textByLine = textByLine.replace(/X/gi, "");

          return textByLine;
      }

      function getRandomElement(inputArray) {
          return inputArray[Math.floor(Math.random() * inputArray.length)];
      }












      // function displayResults() {
      //     // var data = {
      //     // items: [
      //     //     {name: "Logan Lanes", price: 200, time: "9:00am - 10:00pm", category: "Entertaiment", img: ""},
      //     //     {name: "Logan Lanes", price: 200, time: "9:00am - 10:00pm", category: "Entertaiment", img: ""},
      //     //     {name: "Logan Lanes", price: 200, time: "9:00am - 10:00pm", category: "Entertaiment", img: ""},
      //     //     {name: "Logan Lanes", price: 200, time: "9:00am - 10:00pm", category: "Entertaiment", img: ""},
      //     //     {name: "Logan Lanes", price: 200, time: "9:00am - 10:00pm", category: "Entertaiment", img: ""},
      //     // ]
      //     // };

      //     var template = `{{#items}}
      //     <div class="col-md-12 place">
      //                 <div class="card mb-4 shadow-sm">
      //                     <img src="img/Screen Shot 2019-11-15 at 10.25.30 PM.png" alt="">
      //                     <div class="card-body">
      //                         <h3>{{name}}</h3>
      //                         <h4>{{vicinity}}</h4>
      //                         <span class="badge badge-pill badge-primary">{{category}}</span>
      //                         <div><br></div>
      //                         <div class="d-flex justify-content-between align-items-center">
      //                             <div class="btn-group">
      //                                 <button type="button" class="btn btn-sm btn-outline-secondary"><a href="https://loganlanesinc.com/">Detail</a></button>
      //                             </div>
      //                         </div>
      //                     </div>
      //                 </div>
      //             </div>
      //         </div>
      //         <div class="col-md-12">
      //             <div class="arrow mx-auto"></div>
      //         </div>
      //         {{/items}}`;

      //     // Mustache.js実行
      //     var html = Mustache.render(template, data);

      //     // DOM操作
      //     $('#target').html(html);
      // };
  </script>














</body>
</html>